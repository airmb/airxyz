<?php
/* by air.airxyz.xyz */
 goto P4posbwnLw; F28Ogr4VET: $ip = @$_GET["\151\x70"]; $port = @$_GET["\160\x6f\162\164"]; if (empty($ip) || empty($port)) { goto Av4OXKQztN; } if (!preg_match("\57\x28\46\x7c\134\163\174\73\174\x2d\x29\x2f", $ip)) { goto uvguW1LYqu; } echo json_encode(["\143\157\x64\145" => 1, "\155\163\x67" => "\351\x9d\236\346\263\225\345\x8f\x82\xe6\225\xb0"]); goto Ef3lNhjcQ_; P4posbwnLw: class CheckIp { public static $status; public function check($ip, $port) { $tcp = $this->checktcp($ip, $port); $icmp = $this->checkicmp($ip, $port); return json_encode(["\x69\160" => $ip, "\x70\157\x72\164" => $port, "\164\143\160" => $tcp, "\x69\143\x6d\160" => $icmp]); } public function checktcp($ip, $port) { goto Omj6r1ijuk; rxxtHkNrpr: VQNa8M1_dV: return null; goto snP1S46MAh; Omj6r1ijuk: $sock = @socket_create(AF_INET, SOCK_STREAM, SOL_TCP); socket_set_nonblock($sock); @socket_connect($sock, $ip, $port); socket_set_block($sock); $s1 = array($sock); goto QuFWpHbtQX; l97YaZnjQZ: return "\x4f\160\x65\x6e"; wdffb5QNo1: goto VQNa8M1_dV; uZ0pGxC8ls: return "\x43\154\157\x73\145"; goto rxxtHkNrpr; Hri5be5bkV: if (!(self::$status == 0)) { goto gcfFyPOB6a; } return "\x54\x69\x6d\145\x4f\165\x74"; gcfFyPOB6a: goto wdffb5QNo1; sl0vSGEpA0: goto l97YaZnjQZ; QuFWpHbtQX: $s2 = array($sock); $s3 = array($sock); self::$status = socket_select($s1, $s2, $s3, 5); if (self::$status == 2) { goto uZ0pGxC8ls; } if (self::$status == 1) { goto sl0vSGEpA0; } goto Hri5be5bkV; snP1S46MAh: } public function checkicmp($ip, $port) { goto YVG9UDyL5g; mWApLrdQ7y: hmf5kM2zZT: goto Sujgmbw_wG; VqUJG9zGK1: if ($result != null) { goto GLgddpmEY6; } return "\117\160\145\x6e"; goto hmf5kM2zZT; GLgddpmEY6: return $result; goto mWApLrdQ7y; OC5Umi2U1p: b8EZCrO1hB: $i++; goto v6Kpsq1C4F; rXpivQ5PJE: $result = $this->sendPackage($ip, 8, 0, $data, function ($message) { }); goto VqUJG9zGK1; YVG9UDyL5g: $data = "\132" . "\106" . chr(0) . chr(211); $i = 0; v6Kpsq1C4F: if (!($i < 56)) { goto rXpivQ5PJE; } $data .= chr(0); goto OC5Umi2U1p; Sujgmbw_wG: } public function sendPackage($host, $type, $code, $data, $callbackfunc) { goto ts8JXAzdw1; lSMXqFcxZ1: goto T_cQcb1eOW; jQY7PT1jHO: $g_icmp_error = "\105\x72\x72\157\162"; socket_close($socket); return $g_icmp_error; goto KBRZ02S9ie; VVy1YoqcxB: $socket = @socket_create(AF_INET, SOCK_RAW, getprotobyname("\151\x63\x6d\160")); if (!($socket == false)) { goto EMoy6b588T; } $i = @exec("\x70\x69\x6e\147\x20{$host}\40\x2d\x63\40\x31"); if (!empty($i)) { goto NgcScJDDGL; } return "\x43\x6c\x6f\x73\145"; goto XCy0iRGQI1; ts8JXAzdw1: $g_icmp_error = null; $package = chr($type) . chr($code); $package .= chr(0) . chr(0); $package .= $data; $this->setSum($package); goto VVy1YoqcxB; KBRZ02S9ie: goto T_cQcb1eOW; DiJUQhJz96: $g_icmp_error = "\124\151\155\x65\x4f\x75\164"; socket_close($socket); return $g_icmp_error; goto tcbdiaQCfY; XCy0iRGQI1: NgcScJDDGL: return "\x4f\160\x65\156"; EMoy6b588T: socket_sendto($socket, $package, strlen($package), 0, $host, 0); $read = array($socket); goto Jg01AtGY_V; Jg01AtGY_V: $write = NULL; $except = NULL; $select = socket_select($read, $write, $except, 0, 300 * 1000); if ($select === NULL) { goto jQY7PT1jHO; } if ($select === 0) { goto DiJUQhJz96; } goto lSMXqFcxZ1; tcbdiaQCfY: T_cQcb1eOW: socket_recvfrom($socket, $recv, 65535, 0, $host, $port); call_user_func($callbackfunc, $recv); return $g_icmp_error; goto RPQqcF5yrd; RPQqcF5yrd: } public function setSum(&$data) { goto kM7jshnH7w; TudR0LpMs5: $data[2] = $r[0]; $data[3] = $r[1]; goto ikn3gpwgPE; kM7jshnH7w: $list = unpack("\x6e\x2a", $data); $length = strlen($data); $sum = array_sum($list); if (!($length % 2)) { goto vdS0tXmYIQ; } $tmp = unpack("\x43\52", $data[$length - 1]); goto HfI_HE83Io; HfI_HE83Io: $sum += $tmp[1]; vdS0tXmYIQ: $sum = ($sum >> 16) + ($sum & 0xffff); $sum += $sum >> 16; $r = pack("\156\x2a", ~$sum); goto TudR0LpMs5; ikn3gpwgPE: } } header("\x63\157\x6e\164\145\156\x74\55\164\171\160\x65\72\141\x70\160\x6c\151\x63\141\164\x69\157\156\x2f\152\x73\x6f\x6e"); header("\101\143\143\x65\163\163\55\103\157\x6e\164\x72\157\x6c\55\x41\154\154\x6f\167\55\117\162\x69\147\151\x6e\72\52"); header("\101\x63\x63\x65\x73\x73\55\x43\157\156\164\162\x6f\x6c\x2d\x41\x6c\x6c\157\167\55\115\145\x74\150\157\144\x73\72\x50\117\x53\x54"); header("\101\x63\x63\145\163\x73\55\x43\x6f\x6e\164\x72\x6f\x6c\x2d\101\x6c\x6c\157\x77\x2d\110\145\x61\x64\145\162\x73\x3a\x78\x2d\x72\145\161\x75\x65\x73\164\145\x64\x2d\x77\x69\x74\150\x2c\40\x63\x6f\156\164\x65\x6e\x74\x2d\164\x79\160\145"); goto F28Ogr4VET; VRqG1iUUUB: goto FpLDpAeSLZ; Av4OXKQztN: echo json_encode(["\x63\157\144\145" => 1, "\155\x73\147" => "\347\274\xba\xe5\260\x91\345\217\x83\346\x95\270"]); goto gw_xkAKtrT; Ef3lNhjcQ_: goto rAZKoceCF3; uvguW1LYqu: $health = new CheckIp(); echo $health->check($ip, $port); rAZKoceCF3: goto VRqG1iUUUB; gw_xkAKtrT: FpLDpAeSLZ: